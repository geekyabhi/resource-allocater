version: "3"
services:
    # zookeeper:
    #     image: confluentinc/cp-zookeeper:7.0.1
    #     container_name: zookeeper
    #     environment:
    #         ZOOKEEPER_CLIENT_PORT: 2181
    #         ZOOKEEPER_TICK_TIME: 2000
    #     volumes:
    #         - ~/docker_data/zookeeper:/var/lib/zookeeper

    # broker:
    #     image: confluentinc/cp-kafka:7.0.1
    #     container_name: broker
    #     ports:
    #         - "9092:9092"
    #     depends_on:
    #         - zookeeper
    #     environment:
    #         KAFKA_BROKER_ID: 1
    #         KAFKA_ZOOKEEPER_CONNECT: "zookeeper:2181"
    #         KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_INTERNAL:PLAINTEXT
    #         KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092,PLAINTEXT_INTERNAL://broker:29092
    #         KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
    #         KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1
    #         KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1

    cassandra:
        image: cassandra:latest
        environment:
            - CASSANDRA_CLUSTER_NAME=my_cluster
        volumes:
            - ./cassandra-init-script.cql:/docker-entrypoint-initdb.d/init.cql
        ports:
            - "9042:9042"
        container_name: csfeed
    
    feed:
        build:
            context: ./feed
            dockerfile: Dockerfile
        ports:
            - "5004:5004"
        container_name: feed
        depends_on:
            - cassandra
        restart: always

    msalc:
        image: mysql:latest
        container_name: msalc
        ports:
            - "3307:3306"
        environment:
            MYSQL_ROOT_PASSWORD: Abhinav@1712
        restart: always
    user:
        build:
            context: ./user
            dockerfile: Dockerfile
        ports:
            - "5001:5001"
        container_name: user
        depends_on:
            - msalc
        restart: always
